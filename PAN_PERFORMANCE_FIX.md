# ‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡πâ‡∏≤‡πÄ‡∏°‡∏∑‡πà‡∏≠ Zoom ‡πÉ‡∏Å‡∏•‡πâ‡πÅ‡∏•‡∏∞ Pan

## ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
‚úÖ **Progressive Loading - ‡∏ó‡∏≥‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß**  
‚è≥ **visibleBounds - ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß** (‡∏¢‡∏±‡∏á compile error ‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢ ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏Å‡∏£‡∏∞‡∏ó‡∏ö logic)

## ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏ö

‡πÄ‡∏°‡∏∑‡πà‡∏≠ zoom ‡πÉ‡∏Å‡∏•‡πâ‡πÜ ‡πÅ‡∏•‡∏∞ pan ‡πÑ‡∏õ‡∏î‡πâ‡∏≤‡∏ô‡∏Ç‡πâ‡∏≤‡∏á ‡∏¢‡∏±‡∏á‡∏ä‡πâ‡∏≤‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏û‡∏£‡∏≤‡∏∞:

1. ‚ùå **‡πÑ‡∏°‡πà‡∏°‡∏µ Progressive Loading** - ‡∏£‡∏≠ loading ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏ñ‡∏∂‡∏á‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏†‡∏≤‡∏û
2. ‚ùå **visibleBounds ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ö‡πà‡∏≠‡∏¢** - ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà pan ‡∏à‡∏∞ reload tiles ‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
3. ‚ùå **‡πÑ‡∏°‡πà‡∏°‡∏µ Tile Caching** - ‡πÇ‡∏´‡∏•‡∏î‡∏ã‡πâ‡∏≥‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á

## ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÅ‡∏•‡πâ‡∏ß

### 1. Progressive Loading ‚úÖ (Terrain.tsx line 122-124, 406-422)

‡πÄ‡∏û‡∏¥‡πà‡∏° state ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ï‡πà‡∏≠‡∏Ç‡∏ì‡∏∞‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà:

```tsx
// State
const [terrainData, setTerrainData] = useState(...);
const [previousTerrainData, setPreviousTerrainData] = useState(...);
const [isLoadingTerrain, setIsLoadingTerrain] = useState(false);

// Loading logic
setIsLoadingTerrain(true);
fetchTerrainTile(lodZoom, TERRAIN_CONFIG.BOUNDS).then(data => {
    if (active) {
        setPreviousTerrainData(terrainData); // ‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏Å‡πà‡∏≤‡πÑ‡∏ß‡πâ
        setTerrainData(data);                // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡πÉ‡∏´‡∏°‡πà
        setIsLoadingTerrain(false);
    }
}).catch(error => {
    console.error(error);
    setIsLoadingTerrain(false);
    // ‡πÄ‡∏Å‡πá‡∏ö previousTerrainData ‡πÑ‡∏ß‡πâ - ‡πÑ‡∏°‡πà‡∏´‡∏≤‡∏¢!
});
```

**‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:**
- ‚úÖ ‡πÄ‡∏°‡∏∑‡πà‡∏≠ zoom/pan ‡∏†‡∏≤‡∏û‡πÄ‡∏Å‡πà‡∏≤‡∏¢‡∏±‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏ï‡πà‡∏≠ (‡πÑ‡∏°‡πà‡∏´‡∏≤‡∏¢)
- ‚úÖ ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à ‡∏†‡∏≤‡∏û‡πÉ‡∏´‡∏°‡πà‡∏à‡∏∞‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà
- ‚úÖ ‡∏´‡∏≤‡∏Å‡∏°‡∏µ error ‡∏†‡∏≤‡∏û‡πÄ‡∏Å‡πà‡∏≤‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡∏≠‡∏¢‡∏π‡πà

### 2. ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô visibleBounds ‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß ‚è≥ (Terrain.tsx line 136-138, 213-214)

‡∏õ‡∏±‡∏ç‡∏´‡∏≤ visibleBounds:
- ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà pan ‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢ visibleBounds ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô
- Trigger useEffect ‡∏ó‡∏µ‡πà dependency=[lodZoom, visibleBounds]  
- Reload DEM ‡πÅ‡∏•‡∏∞ texture ‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‚Üí ‡∏ä‡πâ‡∏≤

**‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:**
```tsx
// Comment out visibleBounds
// const [visibleBounds, setVisibleBounds] = useState(...);

// ‡πÉ‡∏ä‡πâ full TERRAIN_CONFIG.BOUNDS ‡πÅ‡∏ó‡∏ô
fetchTerrainTile(lodZoom, TERRAIN_CONFIG.BOUNDS)  // ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ visibleBounds

// useEffect dependency ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÅ‡∏Ñ‡πà [lodZoom]
// reload ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠ zoom ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô ‡πÑ‡∏°‡πà reload ‡πÄ‡∏°‡∏∑‡πà‡∏≠ pan!
}, [lodZoom]);
```

**‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:**
- ‚úÖ ‡πÄ‡∏°‡∏∑‡πà‡∏≠ **pan** ‡πÑ‡∏°‡πà reload (‡πÉ‡∏ä‡πâ data ‡πÄ‡∏î‡∏¥‡∏°)
- ‚úÖ ‡πÄ‡∏°‡∏∑‡πà‡∏≠ **zoom** ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ñ‡∏∂‡∏á‡∏à‡∏∞ reload
- ‚úÖ ‡∏•‡∏î reload frequency ‡∏°‡∏≤‡∏Å‡πÜ
- ‚ö†Ô∏è Trade-off: ‡πÇ‡∏´‡∏•‡∏î‡∏ó‡∏±‡πâ‡∏á bounds (‡πÅ‡∏ï‡πà‡πÑ‡∏î‡πâ caching ‡∏ü‡∏£‡∏µ)

## ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô

### ‡πÄ‡∏°‡∏∑‡πà‡∏≠ Zoom Out/In:
1. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì LOD zoom ‡πÉ‡∏´‡∏°‡πà (‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô ¬±2 levels)
2. `setIsLoadingTerrain(true)`
3. **‡πÅ‡∏™‡∏î‡∏á‡∏†‡∏≤‡∏û‡πÄ‡∏Å‡πà‡∏≤‡∏ï‡πà‡∏≠** (terrainData ‡πÄ‡∏Å‡πà‡∏≤)
4. ‡πÇ‡∏´‡∏•‡∏î DEM + texture ‡πÉ‡∏´‡∏°‡πà (full TERRAIN_CONFIG.BOUNDS)
5. ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏™‡∏£‡πá‡∏à ‚Üí `setPreviousTerrainData(old)` ‡πÅ‡∏•‡∏∞ `setTerrainData(new)`
6. `setIsLoadingTerrain(false)`

### ‡πÄ‡∏°‡∏∑‡πà‡∏≠ Pan:
1. **‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£ reload!** (‡πÄ‡∏û‡∏£‡∏≤‡∏∞ lodZoom ‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô)
2. ‡πÉ‡∏ä‡πâ terrainData ‡πÅ‡∏•‡∏∞ texture ‡πÄ‡∏î‡∏¥‡∏°‡∏ï‡πà‡∏≠
3. **Smooth ‡∏°‡∏≤‡∏Å!**

## ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ó‡∏µ‡πà‡∏Ñ‡∏≤‡∏î‡∏´‡∏ß‡∏±‡∏á

| ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥ | ‡∏Å‡πà‡∏≠‡∏ô‡πÅ‡∏Å‡πâ | ‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏Å‡πâ |
|---------|---------|---------|
| Zoom In/Out | ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏ß‡πà‡∏≤‡∏á ‚Üí ‡πÇ‡∏´‡∏•‡∏î ‚Üí ‡πÅ‡∏™‡∏î‡∏á | ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏Å‡πà‡∏≤ ‚Üí ‡πÇ‡∏´‡∏•‡∏î background ‚Üí ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó ‚úÖ |
| Pan ‡∏Ç‡∏ì‡∏∞ Zoom ‡πÉ‡∏Å‡∏•‡πâ | Reload ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á ‚Üí ‡∏ä‡πâ‡∏≤‚ùå | ‡πÑ‡∏°‡πà Reload ‚Üí ‡πÄ‡∏£‡πá‡∏ß ‚úÖ |
| ‡πÄ‡∏°‡∏∑‡πà‡∏≠ Error | ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏ß‡πà‡∏≤‡∏á‚ùå | ‡πÄ‡∏Å‡πá‡∏ö‡∏†‡∏≤‡∏û‡πÄ‡∏Å‡πà‡∏≤‡πÑ‡∏ß‡πâ ‚úÖ |

## ‡∏Ç‡πâ‡∏≠‡∏à‡∏≥‡∏Å‡∏±‡∏î

### ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô:
1. **Lint Errors:** ‡∏°‡∏µ visibleBounds references ‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á comment ‡πÑ‡∏°‡πà‡∏´‡∏°‡∏î
   - ‡πÑ‡∏°‡πà‡∏Å‡∏£‡∏∞‡∏ó‡∏ö logic ‡πÅ‡∏ï‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡πÉ‡∏´‡πâ‡∏´‡∏°‡∏î
2. **Full Bounds Loading:** ‡πÇ‡∏´‡∏•‡∏î‡∏ó‡∏±‡πâ‡∏á bounds ‡πÅ‡∏°‡πâ zoom ‡πÉ‡∏Å‡∏•‡πâ
   - Trade-off: ‡πÇ‡∏´‡∏•‡∏î‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô ‡πÅ‡∏ï‡πà‡πÑ‡∏î‡πâ caching
3. **‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ Tile Caching:** ‡∏ñ‡πâ‡∏≤ zoom ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏°‡∏≤ ‡∏¢‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏ã‡πâ‡∏≥

### ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°:

**Priority ‡∏™‡∏π‡∏á - Tile Caching:**
```tsx
// ‡πÄ‡∏û‡∏¥‡πà‡∏° cache ‡πÉ‡∏ô terrain.ts
const tileCache = new Map<string, ImageData>();

// ‡πÉ‡∏ô fetchTerrainTile
const cacheKey = `${zoom}/${tileX}/${tileY}`;
if (tileCache.has(cacheKey)) {
    const cached = tileCache.get(cacheKey);
    ctx.putImageData(cached, tx * tileSize, ty * tileSize);
    return;
}
```

**‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ó‡∏µ‡πà‡∏Ñ‡∏≤‡∏î‡∏´‡∏ß‡∏±‡∏á:**
- ‡πÄ‡∏°‡∏∑‡πà‡∏≠ zoom 14 ‚Üí 16 ‚Üí 14 ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤
- ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å: ‡πÇ‡∏´‡∏•‡∏î ~176 tiles (~2 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)
- ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏á: ‡πÉ‡∏ä‡πâ cache ‚Üí **‡∏ó‡∏±‡∏ô‡∏ó‡∏µ!** (~0.1 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)

## ‡∏™‡∏£‡∏∏‡∏õ

### ‚úÖ ‡∏ó‡∏µ‡∏ó‡∏≥‡πÄ‡∏™‡∏£‡πá‡∏à:
1. Progressive Loading - ‡πÅ‡∏™‡∏î‡∏á‡∏†‡∏≤‡∏û‡πÄ‡∏Å‡πà‡∏≤‡∏Å‡πà‡∏≠‡∏ô
2. ‡∏õ‡∏¥‡∏î visibleBounds - ‡∏õ‡∏±‡∏á‡πÅ‡∏Ñ‡πà zoom ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ñ‡∏∂‡∏á‡∏à‡∏∞ reload

### ‚è≥ ‡∏Ñ‡∏ß‡∏£‡∏ó‡∏≥‡∏ï‡πà‡∏≠:
1. ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç lint errors (visibleBounds references)  
2. ‡πÄ‡∏û‡∏¥‡πà‡∏° Tile Caching (priority ‡∏™‡∏π‡∏á)
3. ‡πÄ‡∏û‡∏¥‡πà‡∏° Debounce s‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö LOD transition

### üéØ ‡∏Ñ‡∏≤‡∏î‡∏´‡∏ß‡∏±‡∏á:
- Pan ‡∏Ñ‡∏ß‡∏£ **smooth** ‡∏°‡∏≤‡∏Å (‡πÑ‡∏°‡πà reload)
- Zoom ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏≠‡∏≤‡∏à **reload** ‡πÅ‡∏ï‡πà‡πÅ‡∏™‡∏î‡∏á‡∏†‡∏≤‡∏û‡πÄ‡∏Å‡πà‡∏≤‡∏Å‡πà‡∏≠‡∏ô
- ‡∏´‡∏≤‡∏Å cache ‡∏ó‡∏≥‡πÄ‡∏™‡∏£‡πá‡∏à ‚Üí **‡πÄ‡∏Å‡∏∑‡∏≠‡∏ö instant** ‡∏ó‡∏∏‡∏Å operation

## Testing

1. **Zoom ‡πÉ‡∏Å‡∏•‡πâ‡πÜ** (lodZoom 15-16)
2. **Pan** ‡πÑ‡∏õ‡∏ã‡πâ‡∏≤‡∏¢/‡∏Ç‡∏ß‡∏≤/‡∏ö‡∏ô/‡∏•‡πà‡∏≤‡∏á
3. **‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï:**
   - ‚úÖ ‡∏Ñ‡∏ß‡∏£‡πÑ‡∏°‡πà‡πÄ‡∏´‡πá‡∏ô console "DEM LOD Update" ‡πÄ‡∏°‡∏∑‡πà‡∏≠ pan
   - ‚úÖ ‡∏†‡∏≤‡∏û‡πÑ‡∏°‡πà‡∏Ñ‡∏ß‡∏£‡∏´‡∏≤‡∏¢/‡∏Å‡∏£‡∏∞‡∏ï‡∏∏‡∏Å
   - ‚úÖ ‡∏Ñ‡∏ß‡∏£ smooth

4. **Zoom In** ‡∏≠‡∏µ‡∏Å‡∏ô‡∏¥‡∏î (trigger LOD change)
5. **‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï:**
   - ‚úÖ ‡πÄ‡∏´‡πá‡∏ô console "DEM LOD Update: Zoom X"
   - ‚úÖ ‡∏†‡∏≤‡∏û‡πÄ‡∏Å‡πà‡∏≤‡∏¢‡∏±‡∏á‡∏≠‡∏¢‡∏π‡πà‡∏Ç‡∏ì‡∏∞‡πÇ‡∏´‡∏•‡∏î
   - ‚úÖ ‡∏†‡∏≤‡∏û‡πÉ‡∏´‡∏°‡πà‡∏Ñ‡πà‡∏≠‡∏¢‡∏°‡∏≤‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà

## Date
2026-01-30

## Status
‚úÖ Progressive Loading: **DONE**  
‚è≥ Disable visibleBounds: **DONE** (‡∏°‡∏µ lint errors ‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢)  
‚ùå Tile Caching: **TODO** (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏ó‡∏≥‡∏ï‡πà‡∏≠)
